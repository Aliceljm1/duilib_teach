/*
* 动态列表demo，
*/
#include "StdAfx.h"
#include "ErrorMainForm.h"
#include "MenuWnd.h"
#include "..\DuiLib\UIlib.h"
#include "StackWalker.h"

using namespace DuiLib;


class MyStackWalker : public StackWalker
{
public:
	MyStackWalker() : StackWalker()
	{
		m_info = "";
	}

	string m_info;

	virtual void OnOutput(LPCSTR szText) {
		printf(szText);
		m_info.append(szText);
		StackWalker::OnOutput(szText);
	}
};

void myPurecallHandler(void)
{
	MyStackWalker sw;
	sw.ShowCallstack();
	MessageBox(NULL, sw.m_info.c_str(), sw.m_info.c_str(), NULL);
	exit(0);
}


int APIENTRY WinMain(HINSTANCE hInstance, HINSTANCE /*hPrevInstance*/, LPSTR /*lpCmdLine*/, int nCmdShow)
{
	_set_purecall_handler(myPurecallHandler);//增加纯虚函数捕获函数，

	CPaintManagerUI::SetInstance(hInstance);
	//CPaintManagerUI::SetResourcePath(CPaintManagerUI::GetInstancePath() + _T("skin"));
	//CPaintManagerUI::SetResourceZip(_T("ListRes.zip"));//加载资源包，可以解压之后查看里面的xml，png等等。

	ListMainForm* pFrame = new ListMainForm();
	if (pFrame == NULL) return 0;
	pFrame->Create(NULL, _T("ListDemo"), UI_WNDSTYLE_FRAME, WS_EX_STATICEDGE | WS_EX_APPWINDOW, 0, 0, 600, 320);
	//创建窗口，包括各种窗口属性，和扩展属性

	char* s = new char[5];
	strcpy(s, "abc00");

	pFrame->CenterWindow();//居中窗口位置

	::ShowWindow(*pFrame, SW_SHOW);//显示窗口

	CPaintManagerUI::MessageLoop();//开启duilib的消息循环，通用做法，Windows是基于消息机制的操作系统

	return 0;
}
